<!DOCTYPE html>
<html>
<head>
	<meta content="IE=10" http-equiv="X-UA-Compatible" />
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <title>文档编辑</title>
    <link href="officecontrol/css/ntkoStyle.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="font-awesome/4.7.0/css/font-awesome.min.css">
	<script type="text/javascript" src="officecontrol/js/ntko.js"></script>
	<script type="text/javascript">
	var cmd;	//命令类型

	function getQueryString(name) {
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
		var r = window.location.search.substr(1).match(reg);
		if (r != null) return unescape(r[2]);
		return null;
	}

	if (window.screen) {//判断浏览器是否支持window.screen判断浏览器是否支持screen  
	  var myw = screen.availWidth;   //定义一个myw，接受到当前全屏的宽  
	  var myh = screen.availHeight;  //定义一个myw，接受到当前全屏的高  
	  window.moveTo(0, 0);           //把window放在左上脚  
	  window.resizeTo(myw, myh);     //把当前窗体的长宽跳转为myw和myh  
	}

	</script>

</head>

<body onload="cmd=getQueryString('cmd');init(cmd);" >

	<div class="divBody">

	<div class="editmain_left">
        <aside class="left-nav">
            <header> <h4>在线编辑</h4> </header>
            <div class="left-nav-body">
                <ul class="nav nav-pills ">
                    <li><a onclick="setReviewMode(true);"  id="setReviewModetrue" class="isChecked" > <i class="fa fa-inbox"></i> 保留痕迹</a></li>
                    <li><a onclick="setReviewMode(false);"  id="setReviewModefalse"> <i class="fa fa-envelope-o"></i> 不留痕迹</a></li>
                    <li><a onclick="setShowRevisions(true);"   id="setShowRevisionstrue" class="isChecked" > <i class="fa fa-certificate"></i> 显示痕迹</a></li>
                    <li><a onclick="setShowRevisions(false);"  id="setShowRevisionsfalse"> <i class="fa fa-file-text-o"></i> 隐藏痕迹</a></li>
                </ul>
            </div>
        </aside>
	</div>

	<div class="editmain_right">
		<div class="top_content">
			<span class="title_left">
				文件名：<label id="title"></label>
			</span>
			<span class="but_right">
                <a class="save" id="save" onclick ="savefile();"></a>
                <a class="close" id="close" onclick ="closeWindow();"></a>
			</span>
		</div>
		<script type="text/javascript" src="officecontrol/js/ntkoofficecontrol.min.js"></script>
		<script language="JScript" for="TANGER_OCX" event="OnDocumentOpened(TANGER_OCX_str,TANGER_OCX_obj)">
			//ntko.EnterRevisionMode = true;
			if(ntko.doctype==1){//判断文档是否是word
				//如果是OFFICE 2013以上版本则设置Options.UseLocalUserInfo属性为true,TANGER_OCX_OBJ为文档控件对象
				if(ntko.getOfficeVer() >= 15){
					ntko.ActiveDocument.Application.Options.UseLocalUserInfo=true;
				}
				//将修订用户名设置成修改者名
				ntko.WebUserName  = userName;
				//默认打开文档时保留痕迹
				ntko.ActiveDocument.TrackRevisions = true; 
			}else{
				// 其他的话，将留痕disabled，留痕只对word有效。
				document.getElementById("setReviewModetrue").setAttribute("style","text-decoration: line-through;");
				document.getElementById("setReviewModefalse").setAttribute("style","text-decoration: line-through;");
				document.getElementById("setShowRevisionstrue").setAttribute("style","text-decoration: line-through;");
				document.getElementById("setShowRevisionsfalse").setAttribute("style","text-decoration: line-through;");
			}
			ntko.FileNew  = false;//禁止新建文档
			ntko.FileOpen  = false;//禁止打开文档
			ntko.FileClose  = false;//禁止关闭文档
			ntko.FileSave  = false;//禁止保存
			ntko.FileSaveAs  = false;//禁止另存为
			ntko.FilePrint  = false;//禁止打印
			ntko.FilePrintPreview  = false;//禁止打印预览
			ntko.FilePageSetup  = false;//禁止文件菜单栏中的页面布局设置
			ntko.FileProperties   = false;//禁止设置属性
			//ntko.IsNoCopy = true;//文档禁止拷贝
			//ntko.IsStrictNoCopy  = true;//禁止拷贝控件中的内容  强制

			//判断文档是否为word，PPT，Excel 不是的话，可能是PDF，打开菜单栏，需要印章
			if(ntko.doctype==1 || ntko.doctype==2 || ntko.doctype==3){
			ntko.Menubar = false;//隐藏菜单栏
			}
			// 只读开启
			if(attCode==2){
				ntko.SetReadOnly(true,'123456',3,3); 
			}
		</script>
	</div>

	</div>
</body>
</html>
